{"dependencies":{"users/gistin/default:fog_oasis/1 Map the final datasets  09 2021":"var SA_class = ui.import && ui.import(\"SA_class\", \"image\", {\n      \"id\": \"users/gistin/fog_oasis/background_class\"\n    }) || ee.Image(\"users/gistin/fog_oasis/background_class\"),\n    till = ui.import && ui.import(\"till\", \"image\", {\n      \"id\": \"users/gistin/fog_oasis/tillandsia\"\n    }) || ee.Image(\"users/gistin/fog_oasis/tillandsia\"),\n    Lomas_class = ui.import && ui.import(\"Lomas_class\", \"image\", {\n      \"id\": \"users/gistin/fog_oasis/fo_class2021\"\n    }) || ee.Image(\"users/gistin/fog_oasis/fo_class2021\"),\n    FO_locs = ui.import && ui.import(\"FO_locs\", \"table\", {\n      \"id\": \"users/gistin/fog_oasis/FO_loc_2021\"\n    }) || ee.FeatureCollection(\"users/gistin/fog_oasis/FO_loc_2021\"),\n    Lomas_regions = ui.import && ui.import(\"Lomas_regions\", \"table\", {\n      \"id\": \"users/gistin/fog_oasis/FO_regions_2021\"\n    }) || ee.FeatureCollection(\"users/gistin/fog_oasis/FO_regions_2021\");\n///////////////////////////////////\r\n//draw resultant maps and locations\r\n///////////////////////////////////\r\n\r\n//either \r\n//https://gistin.users.earthengine.app/view/fogoasis or\r\n//https://gistin.users.earthengine.app/view/fogoasis#regionid=? to highlight a region\r\n//https://gistin.users.earthengine.app/view/fogoasis#llz=lat?,long?,zoomlevel? zone to a point (lat,long, zoom level)\r\n//https://gistin.users.earthengine.app/view/fogoasis#llz=-16.2474,-73.4435,11 zone to a point (lat,long, zoom level) \r\n\r\n\r\n//set up map\r\n\r\n//Map.centerObject(Lomas_regions, 7);\r\n\r\n//Map.setCenter(-75.75, -14.75, 6);\r\nMap.setOptions(\"TERRAIN\");\r\nMap.style().set('cursor', 'crosshair');\r\n\r\n//get # entries\r\n\r\nvar regionid = ui.url.get('regionid',0);\r\nvar llz = ui.url.get('llz',0);\r\n\r\nprint(regionid);\r\nprint(llz);\r\n\r\n//if region and lat long 0 then choose random region to highligh\r\n//if not then zoom into region or lat long, z\r\nif (regionid === 0){\r\n  if (llz === 0){\r\n  regionid = Math.floor(Math.random() * 59) + 1;\r\n  var focusregion = Lomas_regions.filter(ee.Filter.eq('Id',regionid));\r\n  Map.centerObject(focusregion, 8);\r\n  } else {\r\n  var llc =  llz.split(\",\");\r\n  Map.setCenter(Number(llc[1]),Number(llc[0]), Number(llc[2]));\r\n  var thepoint = ee.Geometry.Point([Number(llc[1]), Number(llc[0])]);\r\n  var focusregion = Lomas_regions.filterBounds(thepoint);\r\n  }\r\n} else {\r\n  var focusregion = Lomas_regions.filter(ee.Filter.eq('Id',regionid));\r\n  Map.centerObject(focusregion, 8);\r\n}\r\n\r\n//Build the regions\r\n\r\n\r\n\r\n\r\n\r\n  var otherregions = Lomas_regions.filter(ee.Filter.eq('Class','Fog Oasis'));\r\n  var otherregions = otherregions.filter(ee.Filter.neq('Id',regionid));\r\nvar transit = Lomas_regions.filter(ee.Filter.eq('Class','Transitional'));\r\nvar transit = transit.filter(ee.Filter.neq('Id',regionid));\r\n\r\n\r\n//set map up \r\n\r\n\r\n\r\n\r\n\r\nvar empty = ee.Image().byte();\r\nvar regionsbackground =  empty.paint({\r\n  featureCollection: focusregion,\r\n  color: 1, \r\n  width: 4\r\n}).paint({\r\n  featureCollection: transit,\r\n  color: 2, \r\n  width: 2\r\n}).paint({\r\n   featureCollection: otherregions,\r\n  color: 3, \r\n  width: 2 \r\n});\r\nvar txt = \"Highlighed region: \".concat(regionid);\r\n\r\n\r\n\r\n//build fog oasis raster\r\n\r\nvar weekspallet = [\r\n  'c1b291', //1 week of weak veg\r\n  'e68e1c', //1 week of higher veg\r\n  'f7df07', //2 weeks\r\n  '7bed00', //1 month\r\n  '0ec441', //3 months\r\n  '1e9094']; //6 months\r\n  \r\n  \r\nvar legpallet = [\r\n  'c1b291', //1 week of weak veg\r\n  'e68e1c', //1 week of higher veg\r\n  'f7df07', //2 weeks\r\n  '7bed00', //1 month\r\n  '0ec441', //3 months\r\n  '1e9094',//6 months\r\n  'FFFFFF', //emply cell\r\n  'A900E4'];\r\n  \r\n\r\nvar darkpallet = [\r\n  '2F2B23',\r\n  '382207',\r\n  '3C3600',\r\n  '1E3900',\r\n  '022F10',\r\n  '072324'\r\n  ] ;\r\n\r\n\r\n//add locations\r\nvar locs = ee.FeatureCollection(FO_locs);\r\n\r\n\r\n\r\n//add layers\r\n//build layer to darken background\r\nMap.addLayer(SA_class.updateMask (SA_class.gt(0.1)),{opacity:0.75,min: 1, max: 6, palette:darkpallet},\"Background NDVI\");\r\n \r\n\r\n\r\n//var empty = ee.Image(1).byte();\r\n//Map.addLayer(empty,{opacity:0.65},\"Grey background\");\r\nMap.addLayer(Lomas_class,{min: 1, max: 6, palette:weekspallet},\"Verdant fog oasis\");\r\nMap.addLayer(till, {opacity:0.50,min:0, max:1,palette: ['A900E4','A900E4','A900E4']},'Tillandsia fog oasis');\r\nMap.addLayer(regionsbackground, {min:1, max:3,palette: ['ffa200','222222','ff0000']}, txt);\r\nMap.addLayer(locs, {color: '000000'}, 'Locations');\r\n\r\n\r\n\r\n// Side bar and query of names set up\r\n// Create an empty panel in which to arrange widgets.\r\n// The layout is vertical flow by default.\r\n\r\n\r\nvar title = ui.Label('This map is the results from: Moat et al., “Seeing through the clouds - Mapping desert fog oasis ecosystems using 20 years of MODIS imagery over Peru and Chile,” Int. J. Appl. Earth Obs. Geoinf. is under Creative Commons CC-BY-NC-ND licence _________________________________________ Click on a locality for more information. - - [be patience a lot of data is being processed]');\r\n    title.setUrl(\"https://www.sciencedirect.com/science/article/pii/S0303243421001756\");\r\n    title.style().set('fontWeight', 'bold');\r\nvar title2 = ui.Label('extra stuff').style().set('fontWeight', 'bold');\r\nprint(title2);\r\n\r\nvar panel = ui.Panel({style: {width: '300px'}})\r\n    .add(title);\r\n\r\n\r\n// Set a callback function for when the user clicks the map.\r\nMap.onClick(function(coords) {\r\n  // Create or update the location label (the second widget in the panel)\r\n  var location = 'lon: ' + coords.lon.toFixed(2) + ' ' +\r\n                 'lat: ' + coords.lat.toFixed(2);\r\n\r\n\r\n  var point = ee.Geometry.Point(coords.lon, coords.lat);\r\n  //buffer by 5 pixels\r\n  var buffdist = Map.getScale() * 5;\r\n  var bpoint = point.buffer(buffdist);\r\n  var filtered = locs.filterBounds(bpoint).first();\r\n  var rfiltered = Lomas_regions.filterBounds(bpoint).first();\r\n  //set variables\r\n  var name = \"Fog oasis site name: \";\r\n  var group = \"Fog oasis region ID: \";\r\n  var groupnam = \"Fog oasis Region Name: \";\r\n  var latlong =\"Lat, Long: \";\r\n\r\n\r\n  \r\n  //print(rfiltered.get(\"Id\").getInfo());\r\n  \r\n  \r\n  //build text on clicked point\r\n  if   (filtered.getInfo() === null){\r\n    if (rfiltered.getInfo() === null){\r\n      group = group + \"NULL\";\r\n      groupnam = groupnam +\"NULL\";\r\n    } else {\r\n      group = group + rfiltered.get(\"Id\").getInfo();\r\n      groupnam = groupnam + rfiltered.get(\"Nom\").getInfo();\r\n    }\r\n    name = name + 'NULL';\r\n    latlong = latlong + 'NULL';\r\n  } else {\r\n    name = name + filtered.get(\"Nom_Loma\").getInfo();\r\n    var lat = filtered.get(\"Latitud\").getInfo();\r\n    var long = filtered.get(\"Longitud\").getInfo();\r\n    latlong = latlong + lat + \", \" + long;\r\n    if (rfiltered.getInfo() === null){\r\n      group = group + \"NULL\";\r\n      groupnam = groupnam +\"NULL\";\r\n    } else {\r\n    group = group + rfiltered.get(\"Id\").getInfo();\r\n    groupnam = groupnam + rfiltered.get(\"Nom\").getInfo();\r\n    //and so on\r\n    }\r\n  }\r\n //add text\r\n    panel.widgets().set(1, ui.Label(group));\r\n    panel.widgets().set(2, ui.Label(groupnam));\r\n    panel.widgets().set(3, ui.Label(name));\r\n    panel.widgets().set(4, ui.Label(latlong));\r\n});\r\n\r\n// Add the panel to the ui.root.\r\nui.root.add(panel);\r\n\r\n/////////////////////////////\r\n//add legend////////////////\r\n///////////////////////////\r\n// set position of panel\r\nvar legend = ui.Panel({\r\n  style: {\r\n    position: 'bottom-left',\r\n    padding: '8px 15px'\r\n  }\r\n});\r\n \r\n// Create legend title\r\nvar legendTitle = ui.Label({\r\n  value: 'Verdant Fog Oasis (av. flush)',\r\n  style: {\r\n    fontWeight: 'bold',\r\n    fontSize: '16px',\r\n    margin: '0 0 4px 0',\r\n    padding: '0'\r\n    }\r\n});\r\n \r\n// Add the title to the panel\r\nlegend.add(legendTitle);\r\n \r\n// Creates and styles 1 row of the legend.\r\nvar makeRow = function(color, name) {\r\n \r\n      // Create the label that is actually the colored box.\r\n      var colorBox = ui.Label({\r\n        style: {\r\n          backgroundColor: '#' + color,\r\n          // Use padding to give the box height and width.\r\n          padding: '8px',\r\n          margin: '0 0 4px 0'\r\n        }\r\n      });\r\n \r\n      // Create the label filled with the description text.\r\n      var description = ui.Label({\r\n        value: name,\r\n        style: {margin: '0 0 4px 6px'}\r\n      });\r\n \r\n      // return the panel\r\n      return ui.Panel({\r\n        widgets: [colorBox, description],\r\n        layout: ui.Panel.Layout.Flow('horizontal')\r\n      });\r\n};\r\n \r\n// name of the legend\r\nvar names = ['\u003C2% (\u003C 1 week - Ephemeral)','2% (\u003C1 week)','2-4% (1-2 weeks)','4-8% (2-4 weeks)', '8-25% (1-3 months)','\u003E50% (\u003E6 months)',' ','Tillandsia fog oasis'];\r\n \r\n// Add color and and names\r\nfor (var i = 0; i \u003C 8; i++) {\r\n  legend.add(makeRow(legpallet[i], names[i]));\r\n  } \r\n  legend.add;\r\n \r\n// add legend to map (alternatively you can also print the legend to the console)\r\n//add link to paper:\r\n\r\n      var cite = ui.Label({\r\n        value: 'Moat et al 2021',\r\n        style: {margin: '0 0 4px 6px'}\r\n      });\r\ncite.setUrl(\"https://www.sciencedirect.com/science/article/pii/S0303243421001756\");\r\n//spacer\r\n//legend.add(makeRow(legpallet[6], ''));\r\nlegend.add(cite);\r\nMap.add(legend);\r\n    "},"path":"users/gistin/default:fog_oasis/1 Map the final datasets  09 2021"}